<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Conbello Textile – Tech Pack Template</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-dark: #121212;
    --bg-card: #1e1e1e;
    --text-primary: #e0e0e0;
    --text-secondary: #a0a0a0;
    --border-color: #333;
    --accent-blue: #0077b6;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-primary);
  }
  .header {
    text-align: center;
    padding: 2.5rem 1rem;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border-color);
  }
  .header h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
  }
  .header h2 {
    margin: 0.25rem 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
  }
  .header p {
    margin: 0.5rem 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
  }
  .wrap {
    max-width: 1200px;
    margin: 2.5rem auto 4rem;
    padding: 0 1rem;
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }
  .page {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 2rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: none; /* Pages are hidden by default */
  }
  .page.active {
    display: block; /* Show active page */
  }
  .intro-text {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--text-secondary);
    border-left: 4px solid var(--accent-blue);
    padding-left: 1rem;
    margin-bottom: 2rem;
  }
  h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.5rem;
  }
  .two-column-layout {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 2rem;
  }
  .card {
    background: #242424;
    border-radius: 8px;
    padding: 1.5rem;
    border: 1px solid #2f2f2f;
  }
  .form .row {
    margin-bottom: 1rem;
  }
  .form label {
    display: block;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.3rem;
  }
  .form input[type="text"], .form input[type="password"], .form textarea, .form input[type="file"] {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: #2a2a2a;
    color: var(--text-primary);
    font-size: 1rem;
    outline: none;
  }
  .form textarea {
    resize: vertical;
    min-height: 100px;
  }
  .form input[type="text"]::placeholder, .form input[type="password"]::placeholder, .form textarea::placeholder {
    color: #555;
  }
  .file-input-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .custom-file-upload {
    background: var(--accent-blue);
    color: var(--text-primary);
    padding: 0.75rem 1.25rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  .custom-file-upload:hover {
    background: #005f96;
  }
  .file-name {
    font-size: 0.85rem;
    color: var(--text-secondary);
  }
  .btn-group {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  .btn {
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
  }
  .btn-download {
    background-color: var(--accent-blue);
    color: white;
  }
  .btn-download:hover {
    background-color: #005f96;
  }
  .btn-reset {
    background-color: #555;
    color: white;
  }
  .btn-reset:hover {
    background-color: #444;
  }
  .btn-contact {
    display: block;
    text-align: center;
    background-color: #009688;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  .btn-contact:hover {
    background-color: #00796b;
  }
  .table-preview {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
  }
  .table-preview th, .table-preview td {
    padding: 0.75rem;
    border-bottom: 1px solid #2f2f2f;
    text-align: left;
  }
  .table-preview th {
    background-color: #242424;
    font-weight: 600;
  }
  .table-preview td {
    background-color: #1e1e1e;
  }
  .preview-section {
    margin-bottom: 2rem;
  }
  .logo-box, .image-box {
    width: 100%;
    aspect-ratio: 16 / 9;
    background-color: #2a2a2a;
    border: 2px dashed #444;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    margin-bottom: 0.5rem;
  }
  .logo-box img, .image-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  .small-logo-box {
    width: 50%;
    aspect-ratio: 1 / 1;
    background-color: #2a2a2a;
    border: 2px dashed #444;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    margin-bottom: 0.5rem;
    margin: auto;
  }
  .small-logo-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  .placeholder-text {
    color: #666;
    font-size: 0.9rem;
    text-align: center;
    padding: 1rem;
  }
  .image-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  .page-nav {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 2rem;
  }
  .page-nav button {
    background: #333;
    color: var(--text-primary);
    border: 1px solid #555;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .page-nav button.active, .page-nav button:hover {
    background: var(--accent-blue);
    border-color: var(--accent-blue);
  }
  .footer {
    text-align: center;
    padding: 1.5rem 1rem;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    margin-top: 4rem;
  }
  .footer p {
    margin: 0;
    font-size: 0.8rem;
    color: var(--text-secondary);
  }
  @media (max-width: 768px) {
    .two-column-layout {
      grid-template-columns: 1fr;
    }
  }

  /* Custom modal for download confirmation */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    visibility: hidden;
    opacity: 0;
    transition: visibility 0s, opacity 0.3s;
  }
  .modal.show {
    visibility: visible;
    opacity: 1;
  }
  .modal-content {
    background-color: var(--bg-card);
    padding: 2rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border-color);
    max-width: 400px;
    transform: translateY(-20px);
    transition: transform 0.3s;
  }
  .modal.show .modal-content {
    transform: translateY(0);
  }
  .modal h3 {
    margin-top: 0;
  }
  .modal p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
  }
  .modal .close-btn {
    background-color: var(--accent-blue);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }

  /* Password Overlay Styles */
  .password-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(18, 18, 18, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    backdrop-filter: blur(5px);
    transition: opacity 0.5s ease;
  }
  .password-box {
    background: var(--bg-card);
    padding: 2.5rem;
    border-radius: 12px;
    text-align: center;
    border: 1px solid var(--border-color);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 400px;
  }
  .password-box h2 {
    border-bottom: none;
    margin-bottom: 0.5rem;
  }
  .password-box p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
  }
  .password-box input {
    box-sizing: border-box;
    text-align: center;
    margin-bottom: 1rem;
  }
  .password-box button {
    width: 100%;
    border: none;
    background-color: var(--accent-blue);
    color: white;
  }
  .password-box button:hover {
    background-color: #005f96;
  }
  #passwordError {
    color: #f44336; /* red */
    font-size: 0.85rem;
    margin-top: 1rem;
    height: 1rem;
    display: none; /* Initially hidden */
  }
</style>
</head>
<body>

<!-- Password Protection Overlay -->
<div id="passwordOverlay" class="password-overlay">
    <div class="password-box">
        <h2>Enter Access Code</h2>
        <p>Please enter the password to access the form.</p>
        <input type="password" id="passwordInput" placeholder="Password" autocomplete="current-password">
        <button id="passwordSubmitBtn" class="btn">Submit</button>
        <p id="passwordError">Incorrect password. Please try again.</p>
    </div>
</div>

<!-- Main Content (hidden by default) -->
<div id="mainContent" style="display: none;">
  <header class="header">
    <h1>Conbello Textile</h1>
    <h2>High-end Clothing Manufacturing</h2>
    <p>Your Vision, Our Craft</p>
  </header>

  <div class="wrap">
    <!-- Dynamic pages will be generated here by JavaScript -->
  </div>

  <div class="btn-group">
    <button id="prevBtn" class="btn">Previous</button>
    <div class="page-nav" id="pageNav"></div>
    <button id="nextBtn" class="btn">Next</button>
  </div>
  <div class="btn-group" style="justify-content: center; margin-top: 2.5rem;">
    <button id="btnDownload" class="btn btn-download">Download Tech Pack</button>
    <button id="btnReset" class="btn btn-reset">Reset</button>
  </div>

  <div id="downloadModal" class="modal">
    <div class="modal-content">
      <h3>Download Complete!</h3>
      <p>Your tech pack has been saved to your computer. All images and files are embedded in the file.</p>
      <button class="close-btn">OK</button>
    </div>
  </div>

  <div class="btn-contact-container" style="text-align: center; margin-top: 2rem;">
    <a href="mailto:info@conbello.com" class="btn-contact">CONTACT US</a>
  </div>
  <div class="footer">
    <p>CONBELLO TEXTILE. All rights reserved. 2025</p>
  </div>
</div>

<script>
  // Global DOM element selectors
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  const pageContent = `
    <!-- Page Content for one tech pack -->
    <h2>Basic Product Information {id}</h2>
    <div class="intro-text">
      <p>
        When creating your Tech Pack file, if you don't know or are unsure about certain fields, please write 'I need advice or I'm not sure'. If you think you have a complete Tech Pack file, you don't need to fill out the other sections when you add it.
        <br><br>
        This tech pack template is designed to help you quickly provide the essential details about your garment design. Please fill out the sections below and use the image and file upload fields to share your vision with us. Once you’re done, click the "Download Tech Pack" button at the bottom of the page. This will save the completed file to your computer, which you can then send to us as an email attachment. Our design team will use this information to create a professional, detailed tech pack free of charge.
      </p>
    </div>
    <div class="two-column-layout">
      <div class="card form">
        <h2>Enter Details</h2>
        {customerDetails}
        <div class="row">
          <label for="productName_{id}">Product Name</label>
          <input id="productName_{id}" type="text" placeholder="T-Shirt, Leggings, Hoodie etc" />
        </div>
        <div class="row">
          <label for="productCode_{id}">Product Code</label>
          <input id="productCode_{id}" type="text" placeholder="e.g. JD-2024-001" />
        </div>
        <div class="row">
          <label for="brandName_{id}">Brand Name</label>
          <input id="brandName_{id}" type="text" placeholder="e.g. My Brand" />
        </div>
        <div class="row">
          <label for="description_{id}">Product Description</label>
          <textarea id="description_{id}" placeholder="Describe your product's unique features, fit, and style."></textarea>
        </div>
        <div class="row">
          <label for="brandLogoFile_{id}">Brand Logo (PNG/JPEG)</label>
          <div class="file-input-container">
            <label class="custom-file-upload" for="brandLogoFile_{id}">Upload Logo</label>
            <input id="brandLogoFile_{id}" type="file" accept="image/*" />
            <span id="brandLogoName_{id}" class="file-name"></span>
          </div>
        </div>
      </div>
      <div class="card preview">
        <h2>Live Preview</h2>
        {customerDetailsPreview}
        <div class="preview-section">
          <h3>Product Details</h3>
          <table class="table-preview">
            <tr><th>Product Name</th><td id="v_productName_{id}">—</td></tr>
            <tr><th>Product Code</th><td id="v_productCode_{id}">—</td></tr>
            <tr><th>Brand Name</th><td id="v_brandName_{id}">—</td></tr>
          </table>
        </div>
        <div class="preview-section">
          <h3>Brand Logo</h3>
          <div class="small-logo-box"><img id="logoImg_{id}" alt="" /><div id="logoPlaceholder_{id}" class="placeholder-text">Logo will appear here</div></div>
        </div>
      </div>
    </div>
    <div class="two-column-layout" style="margin-top: 2rem;">
      <div class="card form">
        <h2>Fabric & Materials</h2>
        <div class="row">
          <label for="fabricType_{id}">Fabric Composition</label>
          <input id="fabricType_{id}" type="text" placeholder="e.g. 100% Organic Cotton" />
        </div>
        <div class="row">
          <label for="fabricWeight_{id}">Fabric Weight</label>
          <input id="fabricWeight_{id}" type="text" placeholder="e.g. 200 GSM" />
        </div>
      </div>
      <div class="card preview">
        <h2>Live Preview</h2>
        <div class="preview-section">
          <h3>Material Details</h3>
          <table class="table-preview">
            <tr><th>Fabric Composition</th><td id="v_fabricType_{id}">—</td></tr>
            <tr><th>Fabric Weight</th><td id="v_fabricWeight_{id}">—</td></tr>
          </table>
        </div>
      </div>
    </div>
    <div class="two-column-layout" style="margin-top: 2rem;">
      <div class="card form">
        <h2>Upload Your Images & Files</h2>
        <div class="row">
          <label for="productImgsFile_{id}">Product Images (up to 4)</label>
          <div class="file-input-container">
            <label class="custom-file-upload" for="productImgsFile_{id}">Choose Images</label>
            <input id="productImgsFile_{id}" type="file" accept="image/*" multiple />
            <span id="productImgsName_{id}" class="file-name"></span>
          </div>
        </div>
        <div class="row">
          <label for="pdfFile_{id}">UPLOAD PDF</label>
          <div class="file-input-container">
            <label class="custom-file-upload" for="pdfFile_{id}">Choose File</label>
            <input id="pdfFile_{id}" type="file" accept=".pdf" />
            <span id="pdfFileName_{id}" class="file-name"></span>
          </div>
        </div>
        <div class="row">
          <label for="pptFile_{id}">UPLOAD POWERPOINT</label>
          <div class="file-input-container">
            <label class="custom-file-upload" for="pptFile_{id}">Choose File</label>
            <input id="pptFile_{id}" type="file" accept=".ppt,.pptx" />
            <span id="pptFileName_{id}" class="file-name"></span>
          </div>
        </div>
      </div>
      <div class="card preview">
        <h2>Live Preview</h2>
        <div class="preview-section">
          <h3>Product Views</h3>
          <div class="image-grid" id="imgGrid_{id}">
            <div class="image-box"><img alt="" data-label="Görsel 1" /><div class="placeholder-text">Görsel 1</div></div>
            <div class="image-box"><img alt="" data-label="Görsel 2" /><div class="placeholder-text">Görsel 2</div></div>
            <div class="image-box"><img alt="" data-label="Görsel 3" /><div class="placeholder-text">Görsel 3</div></div>
            <div class="image-box"><img alt="" data-label="Görsel 4" /><div class="placeholder-text">Görsel 4</div></div>
          </div>
        </div>
        <div class="preview-section">
          <h3>Uploaded Documents</h3>
          <h4>PDF File</h4>
          <p id="v_pdfFile_{id}" style="color: var(--text-secondary);">No file uploaded</p>
          <h4>POWERPOINT File</h4>
          <p id="v_pptFile_{id}" style="color: var(--text-secondary);">No file uploaded</p>
        </div>
      </div>
    </div>
    <div class="two-column-layout" style="margin-top: 2rem;">
      <div class="card form">
        <h2>Color & Size</h2>
        <div class="row">
          <label for="colors_{id}">Color(s)</label>
          <input id="colors_{id}" type="text" placeholder="e.g. Navy Blue, Forest Green" />
        </div>
        <div class="row">
          <label for="colorCodes_{id}">Color Code(s) (Pantone, etc.)</label>
          <input id="colorCodes_{id}" type="text" placeholder="e.g. Pantone 19-4052 TCX" />
        </div>
        <div class="row">
          <label for="sizes_{id}">Size Range</label>
          <input id="sizes_{id}" type="text" placeholder="e.g. XS, S, M, L, XL" />
        </div>
        <div class="row">
          <label for="moq_{id}">Minimum Order Quantity (MOQ)</label>
          <input id="moq_{id}" type="text" placeholder="e.g. 500 pcs per color" />
        </div>
      </div>
      <div class="card preview">
        <h2>Live Preview</h2>
        <div class="preview-section">
          <h3>Color & Size Details</h3>
          <table class="table-preview">
            <tr><th>Color(s)</th><td id="v_colors_{id}">—</td></tr>
            <tr><th>Color Code(s)</th><td id="v_colorCodes_{id}">—</td></tr>
            <tr><th>Size Range</th><td id="v_sizes_{id}">—</td></tr>
            <tr><th>MOQ</th><td id="v_moq_{id}">—</td></tr>
          </table>
        </div>
      </div>
    </div>
    <div class="card form" style="margin-top: 2rem;">
      <div class="row">
        <label for="additionalNotes_{id}">Additional Comments</label>
        <textarea id="additionalNotes_{id}" placeholder="e.g. Placement of embroidered logo on sleeve, specific stitching details, special finishing."></textarea>
      </div>
    </div>
    <div class="card preview" style="margin-top: 2rem;">
      <h2>Live Preview</h2>
      <div class="preview-section">
        <h3>Comments</h3>
        <p id="v_additionalNotes_{id}" style="white-space: pre-wrap; color: var(--text-secondary); line-height: 1.6;">—</p>
      </div>
    </div>
  `;
  
  const customerDetails = `
    <div class="row">
      <label for="fullName_{id}">Full Name</label>
      <input id="fullName_{id}" type="text" placeholder="Full Name" />
    </div>
    <div class="row">
      <label for="mobilePhone_{id}">Mobile Phone</label>
      <input id="mobilePhone_{id}" type="text" placeholder="+90 555 123 45 67" />
    </div>
    <div class="row">
      <label for="email_{id}">E-mail</label>
      <input id="email_{id}" type="text" placeholder="name@example.com" />
    </div>
  `;

  const customerDetailsPreview = `
    <div class="preview-section">
      <h3>Customer Details</h3>
      <table class="table-preview">
        <tr><th>Full Name</th><td id="v_fullName_{id}">—</td></tr>
        <tr><th>Mobile Phone</th><td id="v_mobilePhone_{id}">—</td></tr>
        <tr><th>E-mail</th><td id="v_email_{id}">—</td></tr>
      </table>
    </div>
  `;

  // State variables for page navigation
  let currentPageIndex = 0;
  const totalPages = 5;
  const wrap = $('.wrap');
  const pageNavContainer = $('#pageNav');
  const prevBtn = $('#prevBtn');
  const nextBtn = $('#nextBtn');
  const downloadModal = $('#downloadModal');
  const modalCloseBtn = $('.modal .close-btn');

  // Data storage
  const pageData = {};

  // Utility to set text content
  const setText = (id, val) => {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = val.trim() ? val : '—';
    }
  };

  // Utility to read file as Data URL
  const fileToDataURL = file => {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  };

  // Create pages and append them to the DOM
  for (let i = 1; i <= totalPages; i++) {
    const pageDiv = document.createElement('div');
    pageDiv.id = `page${i}`;
    pageDiv.classList.add('page');
    let pageHtml = pageContent.replaceAll('{id}', i);
    if (i === 1) {
        // FIX: Replaced '{id}' in the customer detail templates before inserting them
        pageHtml = pageHtml
            .replace('{customerDetails}', customerDetails.replaceAll('{id}', i))
            .replace('{customerDetailsPreview}', customerDetailsPreview.replaceAll('{id}', i));
    } else {
        pageHtml = pageHtml.replace('{customerDetails}', '').replace('{customerDetailsPreview}', '');
    }
    pageDiv.innerHTML = pageHtml;
    wrap.appendChild(pageDiv);
    pageData[`page${i}`] = {
      uploadedFiles: [] // Initialize the files array for sequential uploads
    };
  }
  
  const pages = $$('.page');

  // Bind form inputs to preview elements and save data
  const formBindings = [
    'productName', 'productCode', 'brandName', 'description', 'fabricType',
    'fabricWeight', 'colors', 'colorCodes', 'sizes', 'moq', 'additionalNotes'
  ];
  
  // First page has additional customer details
  const firstPageBindings = ['fullName', 'mobilePhone', 'email', ...formBindings];

  for (let i = 1; i <= totalPages; i++) {
    const currentBindings = i === 1 ? firstPageBindings : formBindings;
    currentBindings.forEach(src => {
      const input = $(`#${src}_${i}`);
      if (input) {
        input.addEventListener('input', () => {
          setText(`v_${src}_${i}`, input.value);
          pageData[`page${i}`][src] = input.value;
        });
      }
    });

    // Handle single image uploads
    const handleSingleFileUpload = (fileInputId, dataKey, nameSpanId, imgElementId, placeholderId) => {
        const input = $(`#${fileInputId}`);
        const nameSpan = $(`#${nameSpanId}`);
        const imgElement = $(`#${imgElementId}`);
        const placeholderElement = $(`#${placeholderId}`);

        input.addEventListener('change', async (e) => {
            const file = e.target.files && e.target.files[0];
            if (file) {
                const url = await fileToDataURL(file);
                if (imgElement) imgElement.src = url;
                if (placeholderElement) placeholderElement.style.display = 'none';
                if (nameSpan) nameSpan.textContent = file.name;
                pageData[`page${i}`][dataKey] = [{ name: file.name, data: url }];
            } else {
                if (imgElement) imgElement.removeAttribute('src');
                if (placeholderElement) placeholderElement.style.display = 'block';
                if (nameSpan) nameSpan.textContent = '';
                delete pageData[`page${i}`][dataKey];
            }
        });
    };

    handleSingleFileUpload(`brandLogoFile_${i}`, 'brandLogo', `brandLogoName_${i}`, `logoImg_${i}`, `logoPlaceholder_${i}`);
    
    // Handle multiple product image uploads sequentially
    const productImgsInput = $(`#productImgsFile_${i}`);
    const nameSpan = $(`#productImgsName_${i}`);
    const imgBoxes = $$(`#imgGrid_${i} .image-box`);

    productImgsInput.addEventListener('change', async (e) => {
        const newFiles = Array.from(e.target.files);
        
        pageData[`page${i}`].uploadedFiles.push(...newFiles);
        
        const filesToProcess = pageData[`page${i}`].uploadedFiles.slice(0, 4);

        nameSpan.textContent = filesToProcess.map(f => f.name).join(', ') || '';

        pageData[`page${i}`].productImages = [];
        
        for (let j = 0; j < filesToProcess.length; j++) {
            const file = filesToProcess[j];
            if (file) {
                const url = await fileToDataURL(file);
                imgBoxes[j].querySelector('img').src = url;
                imgBoxes[j].querySelector('.placeholder-text').style.display = 'none';
                pageData[`page${i}`].productImages.push({ name: file.name, data: url });
            }
        }
        
        for (let j = filesToProcess.length; j < 4; j++) {
            imgBoxes[j].querySelector('img').removeAttribute('src');
            imgBoxes[j].querySelector('.placeholder-text').style.display = 'block';
        }
    });

    // Handle document uploads
    const handleDocumentUpload = (fileInputId, dataKey, nameSpanId, vElementId) => {
        const documentInput = $(`#${fileInputId}`);
        const documentNameSpan = $(`#${nameSpanId}`);
        const vDocumentEl = $(`#${vElementId}`);
        
        if (documentInput) {
            documentInput.addEventListener('change', async (e) => {
                const file = e.target.files && e.target.files[0];
                if (file) {
                    documentNameSpan.textContent = file.name;
                    const url = await fileToDataURL(file);
                    pageData[`page${i}`][dataKey] = { name: file.name, data: url, mime: file.type };
                    if (vDocumentEl) vDocumentEl.textContent = file.name;
                } else {
                    documentNameSpan.textContent = '';
                    delete pageData[`page${i}`][dataKey];
                    if (vDocumentEl) vDocumentEl.textContent = 'No file uploaded';
                }
            });
        }
    };
    
    handleDocumentUpload(`pdfFile_${i}`, 'pdfDocument', `pdfFileName_${i}`, `v_pdfFile_${i}`);
    handleDocumentUpload(`pptFile_${i}`, 'pptDocument', `pptFileName_${i}`, `v_pptFile_${i}`);
  }

  // Page navigation logic
  const showPage = (index) => {
    pages.forEach((page, i) => {
      page.classList.toggle('active', i === index);
    });
    const navButtons = $$('.page-nav button');
    navButtons.forEach((btn, i) => {
      btn.classList.toggle('active', i === index);
    });
    prevBtn.disabled = index === 0;
    nextBtn.disabled = index === totalPages - 1;
    currentPageIndex = index;
  };

  const createPageNav = () => {
    for (let i = 0; i < totalPages; i++) {
      const button = document.createElement('button');
      button.textContent = i + 1;
      button.addEventListener('click', () => showPage(i));
      pageNavContainer.appendChild(button);
    }
  };

  prevBtn.addEventListener('click', () => {
    if (currentPageIndex > 0) {
      showPage(currentPageIndex - 1);
    }
  });

  nextBtn.addEventListener('click', () => {
    if (currentPageIndex < totalPages - 1) {
      showPage(currentPageIndex + 1);
    }
  });

  // Download filled HTML logic
  $('#btnDownload').addEventListener('click', () => {
    const newDoc = document.implementation.createHTMLDocument('Tech Pack');
    const newHtml = `
      <!doctype html>
      <html lang="en">
      <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Tech Pack Download</title>
      <style>${document.querySelector('style').innerHTML.replace('.password-overlay{display:flex}','').replace('#mainContent{display:block}','')}</style>
      </head>
      <body>
      <header class="header"><h1>Conbello Textile</h1><h2>High-end Clothing Manufacturing</h2><p>Your Vision, Our Craft</p></header>
      <div class="wrap"></div>
      <div class="footer"><p>CONBELLO TEXTILE. All rights reserved. 2025</p></div>
      </body>
      </html>
    `;
    newDoc.documentElement.innerHTML = newHtml;

    const newWrap = newDoc.querySelector('.wrap');
    
    for (let i = 1; i <= totalPages; i++) {
      const data = pageData[`page${i}`];
      if (Object.keys(data).length <= 1) continue; 

      const pageDiv = newDoc.createElement('div');
      pageDiv.classList.add('page');
      pageDiv.id = `downloadPage${i}`;
      pageDiv.style.display = 'block';

      pageDiv.innerHTML += `<h2>Basic Product Information ${i}</h2><div class="card preview">`;
      if (i === 1 && (data.fullName || data.mobilePhone || data.email)) {
          pageDiv.innerHTML += `<h3>Customer Details</h3><table class="table-preview"><tr><th>Full Name</th><td>${data.fullName || '—'}</td></tr><tr><th>Mobile Phone</th><td>${data.mobilePhone || '—'}</td></tr><tr><th>E-mail</th><td>${data.email || '—'}</td></tr></table>`;
      }
      pageDiv.innerHTML += `<h3>Product Details</h3><table class="table-preview"><tr><th>Product Name</th><td>${data.productName || '—'}</td></tr><tr><th>Product Code</th><td>${data.productCode || '—'}</td></tr><tr><th>Brand Name</th><td>${data.brandName || '—'}</td></tr></table></div>`;
      if (data.brandLogo && data.brandLogo.length > 0) {
        pageDiv.innerHTML += `<div class="card preview"><h3>Brand Logo</h3><div class="small-logo-box"><img src="${data.brandLogo[0].data}" alt="Brand Logo" /></div></div>`;
      }
      pageDiv.innerHTML += `<div class="card preview"><h3>Product Description</h3><p style="white-space: pre-wrap; color: var(--text-secondary);">${data.description || '—'}</p></div>`;

      pageDiv.innerHTML += `<h2>Fabric & Materials</h2><div class="card preview"><h3>Material Details</h3><table class="table-preview"><tr><th>Fabric Composition</th><td>${data.fabricType || '—'}</td></tr><tr><th>Fabric Weight</th><td>${data.fabricWeight || '—'}</td></tr></table></div>`;
      
      pageDiv.innerHTML += `<h2>Product Images & Sketch</h2><div class="card preview"><h3>Product Views</h3><div class="image-grid">`;
      if (data.productImages && data.productImages.length > 0) {
        data.productImages.forEach(img => {
          pageDiv.innerHTML += `<div class="image-box"><img src="${img.data}" alt="Product Image" /></div>`;
        });
      }
      pageDiv.innerHTML += `</div></div>`;

      pageDiv.innerHTML += `<h2>Color & Size</h2><div class="card preview"><h3>Color & Size Details</h3><table class="table-preview"><tr><th>Color(s)</th><td>${data.colors || '—'}</td></tr><tr><th>Color Code(s)</th><td>${data.colorCodes || '—'}</td></tr><tr><th>Size Range</th><td>${data.sizes || '—'}</td></tr><tr><th>MOQ</th><td>${data.moq || '—'}</td></tr></table></div>`;
      
      pageDiv.innerHTML += `<h2>Additional Comments & Documents</h2><div class="card preview"><h3>Comments</h3><p style="white-space: pre-wrap; color: var(--text-secondary);">${data.additionalNotes || '—'}</p></div>`;
      if (data.pdfDocument) {
        pageDiv.innerHTML += `<div class="card preview"><h3>Uploaded PDF Document</h3><p><a href="${data.pdfDocument.data}" download="${data.pdfDocument.name}">${data.pdfDocument.name}</a></p></div>`;
      }
      if (data.pptDocument) {
        pageDiv.innerHTML += `<div class="card preview"><h3>Uploaded POWERPOINT Document</h3><p><a href="${data.pptDocument.data}" download="${data.pptDocument.name}">${data.pptDocument.name}</a></p></div>`;
      }

      newWrap.appendChild(pageDiv);
    }
    
    const name = ($('#productName_1').value || 'tech-pack').replace(/[^\w\-]+/g,'_');
    const html = newDoc.documentElement.outerHTML;
    const blob = new Blob([html], {type: 'text/html;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${name}.html`;
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
    
    downloadModal.classList.add('show');
  });

  // Reset button logic
  $('#btnReset').addEventListener('click', () => {
    for (let i = 1; i <= totalPages; i++) {
        $$(`#page${i} input[type="text"], #page${i} textarea`).forEach(input => { input.value = ''; input.dispatchEvent(new Event('input')); });
        
        $$(`#page${i} input[type="file"]`).forEach(input => { input.value = ''; input.dispatchEvent(new Event('change')); });
        
        $$(`#page${i} .file-name`).forEach(span => span.textContent = '');
        $$(`#page${i} img`).forEach(img => img.removeAttribute('src'));
        $$(`#page${i} .placeholder-text`).forEach(ph => ph.style.display = 'block');
        $$(`#page${i} [id^="v_"]`).forEach(el => setText(el.id, ''));

        const vPdfEl = $(`#v_pdfFile_${i}`);
        if(vPdfEl) vPdfEl.textContent = 'No file uploaded';
        const vPptEl = $(`#v_pptFile_${i}`);
        if(vPptEl) vPptEl.textContent = 'No file uploaded';
        
        pageData[`page${i}`] = {
          uploadedFiles: []
        };
    }
    showPage(0);
  });
  
  // Close modal logic
  modalCloseBtn.addEventListener('click', () => {
    downloadModal.classList.remove('show');
  });

  // Initialize on page load
  window.onload = () => {
    createPageNav();
    showPage(0);
  };

  // --- Password Protection Logic ---
  const passwordOverlay = $('#passwordOverlay');
  const mainContent = $('#mainContent');
  const passwordInput = $('#passwordInput');
  const passwordSubmitBtn = $('#passwordSubmitBtn');
  const passwordError = $('#passwordError');
  const correctPassword = 'Conbello2025'; // You can change this password

  const checkPassword = () => {
    if (passwordInput.value === correctPassword) {
        passwordOverlay.style.opacity = '0';
        setTimeout(() => {
            passwordOverlay.style.display = 'none';
        }, 500); // Match CSS transition duration
        mainContent.style.display = 'block';
    } else {
        passwordError.style.display = 'block';
        passwordInput.value = '';
        passwordInput.focus();
    }
  };

  passwordSubmitBtn.addEventListener('click', checkPassword);
  passwordInput.addEventListener('keypress', (e) => {
      passwordError.style.display = 'none';
      if (e.key === 'Enter') {
          checkPassword();
      }
  });

  // Focus the password input on page load
  passwordInput.focus();
</script>
</body>
</html>
